# Blockly

[Blockly](https://developers.google.com/blockly)는 Google에서 만든 block 기반 visual programming editor이다.

![](/contents/blockly/blockly.png)

## Blockly 설치

> Blockly [Get the code](https://developers.google.com/blockly/guides/get-started/get-the-code) 문서 참고

다음 명령으로 blockly 패키지를 설치한다:

```bash
npm install blockly
```

## Blockly 기본 셋업

> Blockly [Workspace creation](https://developers.google.com/blockly/guides/get-started/workspace-creation) 문서 참고

### Injection div

Blockly workspace는 반드시 `<div>`에 injection되어야 하며, 이를 "injection div"라고 부른다:

```tsx
<div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
```

### Injection

다음과 같이 injection div ID, 또는, injection div 자체를 `Blockly.inject`에 전달하여 workspace를 생성한다:

```ts
// Passes the ID.
const workspace = Blockly.inject('blocklyDiv', {
  /* config */
})

// Passes the injection div.
const workspace = Blockly.inject(document.getElementById('blocklyDiv'), {
  /* config */
})
```

### React에서의 workspace injection

React에서는 `useRef`, `useCallback` 훅을 이용하여 다음과 같이 workspace를 생성할 수 있다:

```ts showLineNumbers {10} "useRef" "useCallback"
  const workspaceRef = useRef<Blockly.Workspace>()
  const injectionDivRef = useCallback(
    (node: HTMLDivElement) => {
      const prevWorkspace = workspaceRef.current
      if (prevWorkspace) {
        // uninitialize ...
      }

      if (node) {
        const newWorkspace = Blockly.inject(node, blocklyOptions)
        workspaceRef.current = newWorkspace

        // initialize ...
      } else {
        workspaceRef.current = undefined
      }
    },
    [blocklyOptions]
  )

  return <div ref={injectionDivRef} style="height: 480px; width: 600px;" />
```

> 자세한 내용은 [Blockly Guides](https://developers.google.com/blockly/guides/get-started/what-is-blockly) 등 공식 문서를 참고하시길 바랍니다.

## 기타

### PXT (MakeCode)

[Microsoft MakeCode](https://makecode.com/)는 누구나 게임을 만들고, 디바이스를 코딩하고, Minecraft를 개조할 수 있는
무료 온라인 코딩 학습 플랫폼이다.

![](/contents/blockly/makecode.png)

MakeCode는 [Microsoft Programming Experience Toolkit (PXT)](https://github.com/microsoft/pxt) 프로젝트를 기반으로 하며,
PXT에서는 Blockly를 fork한 [pxt-blockly](https://github.com/Microsoft/pxt-blockly) 프로젝트를 사용한다.

![](/contents/blockly/makecode2.png)

MakeCode와 같은 에디터를 만들기 위해 [pxt-blockly](https://github.com/Microsoft/pxt-blockly)를 검토해야 할 수 있는데,
다행히 며칠전 [PR](https://github.com/microsoft/pxt/pull/9865)을 통해 **pxt-blockly** 의존성이 없어지고,
blockly 자체 플러그인 방식을 사용하도록 업데이트되었다.
